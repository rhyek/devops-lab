
kubectl apply -f cicd/k8s/todos-deployment.yaml
kubectl apply -f cicd/k8s/web-deployment.yaml
kubectl apply -f cicd/k8s/ingress.yaml

docker build -t devops-lab/builder -f ./cicd/builder.Dockerfile .
docker build -t devops-lab/web -f ./src/app-web/Dockerfile .
docker build -t devops-lab/todos -f ./src/service-todos/Dockerfile .
docker tag devops-lab/web gcr.io/rhyek-devops-lab-1/web
docker tag devops-lab/todos gcr.io/rhyek-devops-lab-1/todos
docker push gcr.io/rhyek-devops-lab-1/web
docker push gcr.io/rhyek-devops-lab-1/todos
kubectl set image deployments/app-web app-web=gcr.io/rhyek-devops-lab-1/web:v2
kubectl set image deployments/service-todos service-todos=gcr.io/rhyek-devops-lab-1/todos:v2
